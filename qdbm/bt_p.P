
%% Load the C Library
%% ?- [bt].

:- import bt_init/3 from bt.
:- import bt_close/1 from bt.
:- import bt_insert/2 from bt.
:- import bt_get/3 from bt.
:- import bt_getl/3 from bt.
:- import bt_getnext/2 from bt.
:- import bt_drop/2 from bt.

%% This function will initialize a btree
btinit(Pred/Arity, Argument, Handle) :- bt_init(Pred/Arity, Argument, Handle).

%% Close a B+ Tree.
btclose(Handle) :- bt_close(Handle).

%% Drop a B+ Tree.
btdrop(Pred/Arity, Argument) :- bt_drop(Pred/Arity, Argument).

%% Insert a Term into a B+ Tree
btinsert(Handle, Term) :- bt_insert(Handle, Term).

%% Non-Deterministically find terms that match the key exactly.
btget(TreeHandle, Key, Value) :- 
	bt_getl(TreeHandle, Key, AnswerHandle),
	btgetnext(AnswerHandle, Value).

btgetnext(AnswerHandle, Value) :- 
	bt_getnext(AnswerHandle, Value0),
	(
		Value = Value0 
		; btgetnext(AnswerHandle, Value)
	).

%% TODO: Prefix and Range queries.