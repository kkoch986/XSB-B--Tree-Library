
?- [nqparse], ['../../bt'], ['../../bt_p'].

tb() :- 
	% parse everything
	walltime(T1),
	nqparse('projects/btc-2012/datahub/data-0.nq'),
	nqparse('projects/btc-2012/datahub/data-1.nq'),
	nqparse('projects/btc-2012/datahub/data-2.nq'),
	nqparse('projects/btc-2012/datahub/data-3.nq'),
	nqparse('projects/btc-2012/datahub/data-4.nq'),
	walltime(T2),
	ParseTime is T2 - T1,
	write('Parsed files in '), write(ParseTime), writeln(' seconds.'),
	walltime(T3),
	btinit(quad/4, 1, Handle),
	btsize(Handle, InitialSize),
	(
		nqnext(R),
		btinsert(Handle, R ),
		fail ; true
	),
	btsize(Handle, Size),
	btclose(Handle),
	walltime(T4),
	BuildTime is T4 - T3,
	Added is Size - InitialSize,
	write('Added '), write(Added), writeln(' entries.'),
	write('Parsing Time: '), write(ParseTime), writeln(' seconds.'),
	write('Building Time: '), write(BuildTime), writeln(' seconds.').

buildbt(File) :-
	btdrop(quad/4, 1),
	appendbt(File).

appendbt(File) :-
	walltime(T1),
	nqload(File),
	walltime(T2),
	btinit(quad/4, 1, Handle),
	btsize(Handle, InitialSize),
	(
		nqnext(R),
		%writeln(R),
		btinsert(Handle, R ),
		fail ; true
	),
	btsize(Handle, Size),
	btclose(Handle),
	walltime(T3),
	ParseTime is T2 - T1,
	BuildTime is T3 - T2,
	Added is Size - InitialSize,
	write('Added '), write(Added), writeln(' entries.'),
	write('Parsing Time: '), write(ParseTime), writeln(' seconds.'),
	write('Building Time: '), write(BuildTime), writeln(' seconds.').