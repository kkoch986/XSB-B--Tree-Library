
:- import wrap/2 from wrapping. 
:- import platform/1 from shell.
:- import misc_error/1 from error_handler.

clean:- 
	shell('rm -f *.dylib *.xwam *.o xsb_wrap_btree.c').

clear_old_trees :- shell('rm -f *.blk').

nuke :- clean, clear_old_trees, make, [bt].

make:- 
	clean,
	xsb_configuration(packagesdir,PkgPath),
	xsb_configuration(config_dir,ConfPath),
	xsb_configuration(emudir,EmuPath),
	% wrap 
	wrap('btree.H','xsb_wrap_btree.c'),
	% compile 
	shell(['g++ -I',ConfPath,' -I',EmuPath,' -I./tpie/include -c -o btree.o btree.c']),
	shell(['gcc -I',ConfPath,' -I',EmuPath,' -I./tpie/include -c xsb_wrap_btree.c']),
	% make dylib
	shell(['g++ -I',ConfPath,' -I',EmuPath,' -lm ', ' -I./tpie/include ',
   	       '-dynamiclib -undefined dynamic_lookup -single_module -nostartfiles ',
 	       '-o btree.dylib btree.o xsb_wrap_btree.o', 
 	       ' ./tpie/lib/libtpie.a']).